<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<button id="box">点击</button>
<p id="obj"></p>
</body>
<script>
    window.onload = function () {
        var data = {name: 'kindeng'};
        var obj = document.getElementById('box');
        obj.onclick = function () {
            data.name = 'hahah'
        }

        observe(data)
        function observe(data) {
            if(! data || typeof  data != 'object'){
                return
            }
            console.log(data)
            Object.keys(data).forEach(function (key) {
                defineReactive(data, key, data[key]);
            })
        }

        function defineReactive(data, key, val) {
            var dep = new Dep()
            observe(val); // 监听子属性
            Object.defineProperty(data, key, {
                enumerable: true, // 可枚举
                configurable: false, // 不能再define
                get: function() {
                    return val;
                },
                set: function(newVal) {
                    console.log('哈哈哈，监听到值变化了 ', val, ' --> ', newVal);
                    val = newVal;
                    dep.notify()
                }
            });
        }
        function Dep() {
            this.subs = []
        }

        Dep.prototype = {
            addSub: function(sub) {
                this.subs.push(sub);
            },
            notify: function() {
                this.subs.forEach(function(sub) {
                    sub.update();
                });
            }
        }
    }

</script>
</html>